CREATE DATABASE WEBDT
USE WEBDT

CREATE TABLE USERS
(
	UserId INT IDENTITY PRIMARY KEY,
	UserName NVARCHAR(30) NOT NULL,
	[PassWord] NVARCHAR(30) NOT NULL,
	Email NVARCHAR(50),
	Phone NVARCHAR(20),
	Allowed INT DEFAULT(0)
)
CREATE TABLE TAIKHOAN
(
	MaTaiKhoan Varchar(10) PRIMARY KEY, 
	TenDangNhap VARCHAR(20),
	MatKhau VARCHAR(32),
)
CREATE TABLE KHACHHANG
(
	MaKhachHang VARCHAR(10) NOT NULL PRIMARY KEY,
	TenKhachHang NVARCHAR(50) NOT NULL ,
	MaTaiKhoan Varchar(10) FOREIGN KEY REFERENCES TAIKHOAN(MaTaiKhoan),
	DiaChiKhachHang NVARCHAR(100)NULL,
	DienThoaiKhach VARCHAR(20) NULL,
	TenDangNhap VARCHAR(50) NOT NULL,
	MatKhau VARCHAR(50) NOT NULL,
	NgaySinh SMALLDATETIME NULL,
	GioiTinh BIT NOT NULL,
	Email VARCHAR(50) NULL
)
CREATE TABLE THUONGHIEU 
(
	MaThuongHieu Varchar(10) not null primary key,
	TenThuongHieu NVARCHAR(50),

)
CREATE TABLE LOAI
(
	MaLoai VarCHAR(10) NOT NULL PRIMARY KEY,
	TenLoai NVARCHAR(50),
)
CREATE TABLE SANPHAM 
(
	MaSanPham VARCHAR(10) NOT NULL PRIMARY KEY,
	TenSanPham NVARCHAR(50) NOT NULL UNIQUE,
	MaThuongHieu VARCHAR(10) FOREIGN KEY REFERENCES THUONGHIEU(MaThuongHieu) NULL,
	TenThuongHieu NVARCHAR(50),
	SoLUong INT,
	MaLoai VARCHAR(10) FOREIGN KEY REFERENCES LOAI(MaLoai) NULL,
	HinhAnh NVarchar(max) NOT NULL,
	KichThuoc INT NOT NULL, 
	NgaySanXuat DATETIME NOT NULL, 
	CPU NVARCHAR (50) NOT NULL, 
	RAM NVARCHAR (50) NOT NULL, 
	HeDieuHanh NVARCHAR (50) NOT NULL,
	MoTa NTEXT NOT NULL,
	Mau NVARCHAR (50) NOT NULL,
	DonGia FLOAT,
	
)

CREATE TABLE DONHANG
(
	SoHoaDon VARCHAR(10) NOT NULL PRIMARY KEY,
	MaSanPham VARCHAR(10) FOREIGN KEY REFERENCES SANPHAM(MaSanPham) NULL,
	MaKhachHang VARCHAR(10) FOREIGN KEY REFERENCES KHACHHANG(MaKhachHang) NULL,
	SoLuong INT NULL,
	DonGia INT NULL,
	ThanhTien INT NULL,
	NgayDatHang SMALLDATETIME NULL,
	NgayGiaoHang SMALLDATETIME NULL
)
CREATE TABLE KHUYENMAI
(
	MaKhuyenMai VarCHAR(7) NOT NULL PRIMARY KEY,
	TenKhuyenMai NVARCHAR(50),
	NgayBatDau DATETIME,
	NgayKetThuc DATETIME
)

---Tạo bảng chi tiết khuyến mãi
CREATE TABLE CHITIETKM
(
	MaKhuyenMai varCHAR(7) NOT NULL,
	MaSanPham VARCHAR(10),
	PHANTRAMKM INT,
	PRIMARY KEY(MaKhuyenMai, MaSanPham)
)
ALTER TABLE CHITIETKM ADD CONSTRAINT FK_CTKM_KM FOREIGN KEY(MaKhuyenMai) REFERENCES KHUYENMAI(MaKhuyenMai)
ALTER TABLE CHITIETKM ADD CONSTRAINT FK_CTKM_SP FOREIGN KEY(MaSanPham) REFERENCES SANPHAM (MaSanPham) 
